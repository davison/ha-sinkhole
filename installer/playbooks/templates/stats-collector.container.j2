[Unit]
Description=HA Sinkhole Stats Collector
PartOf=ha-node-pod.service
Wants=network-online.target
After=network-online.target

[Container]
Pod=ha-node.pod
Image=ghcr.io/davison/ha-sinkhole/stats-collector:{{ ha_sinkhole_manifest[install_channel]['stats-collector'] | default('MISSING_VERSION') }}
Environment=PROMETHEUS_HOST={{ cloud_instance | default('') }}
Environment=PROMETHEUS_ACCOUNT={{ cloud_user | default('') }}
Environment=REAL_HOST={{ inventory_hostname }}
Secret=prometheus_api_token
LogDriver=journald

[Service]
Restart=always

[Install]
WantedBy=multi-user.target
